{{ template "header" . }}
<div class="container-fluid">
	<!-- Page Heading -->
	<div class="d-sm-flex align-items-center justify-content-between mb-4">
		<h1 class="h3 mb-0 text-gray-800 mx-auto">Beneficiaries</h1>
      
	</div>
        <div class="w-50 mx-auto">
     <form class="user" id="myform" method="post" action="/v1/beneficiary">
        <div id="failureAlert" class="alert alert-danger mt-3" style="display: none;"></div>
            <div class="form-group">
                <input type="text" class="form-control form-control-user" name="accountNumber"
                    id="exampleInputEmail" aria-describedby="emailHelp"
                    placeholder="Enter Account Number..." required>
            </div>

    
            <button type="button" onclick="submitForm()" class="btn btn-custom btn-user btn-block">Submit</button>           

        </form> 
        </div>
  <table class="table mt-5">
    <thead> 
      <tr>
         <th>SN</th>
        <th>BankAccountNumber</th>
        <th>BankName</th>
        <th>BankRoutingNumber</th>
        <th>FullName</th>
        <th>SwiftCode</th>
      
      </tr>
    </thead>
    <tbody id="transactionTableBody">
   
    </tbody>
  </table>
<script>
    function submitForm() {
        var formdata = new FormData(document.getElementById("myform"));
        var storedValue = sessionStorage.getItem('token');
        var requestOptions = {
            method: 'POST',
            headers: {
                'X-Auth-Token': storedValue,
            },
            body: formdata,
        };

        fetch("/v1/beneficiary", requestOptions)
            .then(response => response.json()) // Parse the response as JSON
            .then(result => {
                console.log(result);
                if (result.responseCode === "00") {
                    document.getElementById("myform").reset();
                   
                   // Update the HTML table with the received data
                    var tableBody = document.getElementById("transactionTableBody");
                    tableBody.innerHTML = ""; // Clear existing data
                    var index = 1;
                    result.message.forEach(function (data) {
                        var row = tableBody.insertRow(-1);

                        row.insertCell(0).textContent = index++; // SN Column    
                        row.insertCell(1).textContent = data.bankAccountNumber;
                        row.insertCell(2).textContent = data.bankName;
                        row.insertCell(3).textContent = data.bankRoutingNumber;
                        row.insertCell(4).textContent = data.fullName;
                        row.insertCell(5).textContent = data.swiftCode;
                        
                        

                     });
                } else if (result.responseCode === "06") {
                     document.getElementById("failureAlert").innerText = result.message;
                    // Show the failure alert
                    document.getElementById("failureAlert").style.display = "block";
                    // Hide the alert after 7 seconds
                    setTimeout(function () {
                        document.getElementById("failureAlert").style.display = "none";
                    }, 7000);
                }else{
                    window.location.href = "/v1/loginpage";
                }
            })
            .catch(error => console.log('error', error));
    }
</script>

{{ template "footer" . }}
